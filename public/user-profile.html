<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Document</title>
    <style>

        

        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* –°–µ–∫—Ü–∏—è —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º */
        .content {
            margin-bottom: 60px; /* –í—ã—Å–æ—Ç–∞ –ø–∞–Ω–µ–ª–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f4f4f4;
        }

        /* –ü–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .navbar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #fff;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            padding: 10px 0;
            user-select: none;
        }

        /* –ö–Ω–æ–ø–∫–∏ –Ω–∞ –ø–∞–Ω–µ–ª–∏ */
        .navbar button {
            background: none;
            border: none;
            font-size: 16px;
            color: #333;
            cursor: pointer;
            padding: 10px;
            transition: color 0.3s;
        }

        .navbar button:hover {
            color: #007bff;
        }

        .navbar button.active {
            color: #007bff;
        }

        #profile-inf {
            width: 90%;
            min-height: 105px; /* –ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
            /* border: 1px solid; */
            margin: auto;
            background: #fff;
            box-shadow: 0 24px 48px #e6ebf566, 0 1px 4px #e3ebfc;
            border-radius: 12px;
            text-align: left;
            align-content: center;
            padding-left: 20px; /* –î–æ–±–∞–≤–∏—Ç –æ—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ */
            margin-bottom: 20px; /* –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –º–µ–∂–¥—É –ø—Ä–æ—Ñ–∏–ª–µ–º –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ */

        }

        .book-list {
            width: 93%;
            margin: auto;
            background: #fff;
            box-shadow: 0 24px 48px #e6ebf566, 0 1px 4px #e3ebfc;
            border-radius: 12px;
            padding: 10px;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã */
        .book-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            padding: 8px 11px;
            color: black;
            border-radius: 8px;
            margin-bottom: 8px;
            text-align: left;
            font-size: 14px;
            border-bottom: 2px solid #ddd; /* –î–æ–±–∞–≤–∏–ª —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ —Å–ø–∏—Å–∫–æ–º */
        }

        /* –î–µ–ª–∞–µ–º —Ç–µ–∫—Å—Ç –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –Ω–∞ –æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏ */
        .book-header div {
            flex: 1;
            padding: 0 5px;
            white-space: nowrap; /* –ó–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ */
        }

        /* –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ –≤ —Å–ø–∏—Å–∫–µ */
        .book-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 14px;
        }

        /* –ü–æ–∑–≤–æ–ª—è–µ–º —Ç–µ–∫—Å—Ç—É –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è –≤ —Å–ø–∏—Å–∫–µ */
        .book-item .book-title {
            flex: 2;
            word-wrap: break-word; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å—É —Ç–µ–∫—Å—Ç–∞ */
            padding-left: 46px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ */
        .book-date {
            font-weight: bold;
            color: #007bff;
        }

        .book-title {
            color: #333;
        }

        .notifications-box {
            width: 84%;
            min-height: 105px; /* –ó–∞–¥–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
            margin: auto;
            background: #fff;
            box-shadow: 0 24px 48px #e6ebf566, 0 1px 4px #e3ebfc;
            border-radius: 12px;
            text-align: left;
            padding-left: 20px; /* –û—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ */
            padding-top: 10px; /* –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
            padding-bottom: 10px; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            padding-right: 20px; /* –û—Ç—Å—Ç—É–ø —Å–ø—Ä–∞–≤–∞, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –Ω–µ —É–ø–∏—Ä–∞–ª—Å—è –≤ –∫—Ä–∞–π */
            word-wrap: break-word; /* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö —Å–ª–æ–≤ */
        }

        .notifications-box h3 {
            margin: 0;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .notifications-box #notifications-list p {
            margin: 8px 0;
            font-size: 14px;
            color: #666;
            line-height: 1.5; /* –£–≤–µ–ª–∏—á–∏–º –º–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è */
        }

        #requests-container {
            user-select: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
            }

            .request-item {
            padding: 20px;
            background-color: #f4f4f4;
            border: 1px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            }

            .request-item:hover {
            background-color: #e0e0e0;
            }

            .btn {
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            }

            .btn-primary {
            background-color: #007bff;
            color: white;
            border: none;
            }

            .btn-outline-primary {
            background-color: white;
            color: #007bff;
            border: 1px solid #007bff;
            }

            #request-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.5);
            }

        * {
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* * {
            user-select: none;
        } */

    </style>
</head>
<body>

    <div class="content" id="content">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –æ–ø—Ü–∏–π –Ω–∞ –ø–∞–Ω–µ–ª–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.</p>
    </div>    

    <div id="timeoutModal" style="display: none;">
    <h3>–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è —Ç–∞–π–º-–∞—É—Ç–∞</h3>
    <select id="timeoutSelect">
        <option value="600000">10 –º–∏–Ω—É—Ç</option>
        <option value="1800000">30 –º–∏–Ω—É—Ç</option>
        <option value="3600000">1 —á–∞—Å</option>
        <option value="86400000">1 –¥–µ–Ω—å</option>
    </select>
    <button onclick="applyTimeout()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    <button onclick="closeTimeoutModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

    <div class="navbar">
        <button id="newsButton" onclick="changeContent('news')">–ù–æ–≤–æ—Å—Ç–∏</button>
        <button id="booksButton" onclick="changeContent('books')">–ö–Ω–∏–≥–∏</button>
        <button id="profileButton" onclick="changeContent('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
    </div>

    <script>
        let requests = []; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –∑–∞—è–≤–æ–∫

        async function changeContent(section) {
            const content = document.getElementById('content');
            const userRole = await checkUserRole();

            if (section === 'books' && userRole === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {
                section = 'requests';
            }

            // –û—á–∏—â–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.navbar button').forEach(button => {
                button.classList.remove('active');
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω—É–∂–Ω—É—é –∫–Ω–æ–ø–∫—É
            const activeButton = document.getElementById(`${section}Button`);
            if (activeButton) {
                activeButton.classList.add('active');
            }

            if (section === 'news') {
                content.innerHTML = `<h1>–ù–æ–≤–æ—Å—Ç–∏</h1><p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏.</p>`;
            } else if (section === 'books') {
                content.innerHTML = `<h1>–ö–Ω–∏–≥–∏</h1>
                    <div class="book-list" id="book-container">
                        <div class="book-header">
                            <div class="book-date">–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</div>
                            <div class="book-title">–ê–≤—Ç–æ—Ä –∏ –∑–∞–≥–ª–∞–≤–∏–µ –∫–Ω–∏–≥–∏</div>
                        </div>
                    </div>`;
                loadBooks();
            } else if (section === 'requests') {
                content.innerHTML = `<h1>–ó–∞—è–≤–∫–∏</h1>
                    <div id="requests-container"></div>`;
                loadRequests();
            } else if (section === 'profile') {
                content.innerHTML = `<h1>–ü—Ä–æ—Ñ–∏–ª—å</h1>
                    <div id="profile-inf">
                        <div id="student-info"></div>
                    </div>
                    <div id="notifications" class="notifications-box">
                        <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                        <div id="notifications-list"></div>
                    </div>`;
                loadStudentInfo();
                loadNotifications();
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        updateNavButtons().then(() => {
            changeContent('books');
        });

        async function updateNavButtons() {
            const userRole = await checkUserRole();
            const booksButton = document.getElementById('booksButton');

            if (userRole === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {
                booksButton.textContent = '–ó–∞—è–≤–∫–∏';
                booksButton.setAttribute('onclick', "changeContent('requests')");
                booksButton.id = 'requestsButton'; // –ú–µ–Ω—è–µ–º ID, —á—Ç–æ–±—ã –æ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–ª –≤ changeContent()
            }
        }
        async function checkUserRole() {
            const usersData = await fetch('users.json').then(response => response.json());
            const loginValue = localStorage.getItem('login');

            if (!loginValue) return null;

            const cleanedLoginValue = loginValue.replace(/\D/g, '');
            for (let school in usersData) {
                for (let grade in usersData[school].classes) {
                    const classData = usersData[school].classes[grade];
                    for (let student of classData) {
                        const storedPhoneNumber = student['–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'].replace(/\D/g, '');
                        if (storedPhoneNumber === cleanedLoginValue) {
                            return student['–†–æ–ª—å'] || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                        }
                    }
                }
            }
            return null;
        }

    
        async function loadStudentInfo() {
            const usersData = await fetch('users.json').then(response => response.json());
            const loginValue = localStorage.getItem('login');
    
            if (!loginValue) {
                document.getElementById('student-info').innerHTML = '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage.';
                return;
            }
    
            const cleanedLoginValue = loginValue.replace(/\D/g, '');
    
            let studentInfo = '';
            let userFound = false;
    
            for (let school in usersData) {
                for (let grade in usersData[school].classes) {
                    const classData = usersData[school].classes[grade];
                    for (let student of classData) {
                        const storedPhoneNumber = student['–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'].replace(/\D/g, '');
                        if (storedPhoneNumber === cleanedLoginValue) {
                            let educationOrRole = student['–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ'];
                            let label = '–ö–ª–∞—Å—Å';

                            // –ï—Å–ª–∏ "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ" –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ undefined, –ø—Ä–æ–≤–µ—Ä—è–µ–º "–†–æ–ª—å"
                            if (!educationOrRole) {
                                educationOrRole = student['–†–æ–ª—å'] || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                                label = '–†–æ–ª—å';
                            }

                            studentInfo = `
                            <p>${student['–§–∞–º–∏–ª–∏—è']} ${student['–ò–º—è']} ${student['–û—Ç—á–µ—Å—Ç–≤–æ']}</p>
                            <p>${label}: ${educationOrRole}</p>
                            `;
                            userFound = true;
                            break;
                        }
                    }
                }
                if (userFound) break;
            }


    
            document.getElementById('student-info').innerHTML = userFound ? studentInfo : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.';
        }

        function loadNotifications() {
            const notifications = [
                "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 1: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–µ—Ä–Ω–∏—Ç–µ –∫–Ω–∏–≥—É –¥–æ –∫–æ–Ω—Ü–∞ –º–µ—Å—è—Ü–∞.",
                "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 2: –ù–æ–≤—ã–π —É—á–µ–±–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω.",
                "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 3: –í–∞—à–∏ –æ—Ü–µ–Ω–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã."
            ];
            
            const notificationsList = document.getElementById('notifications-list');
            notificationsList.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

            notifications.forEach(notification => {
                const notificationItem = document.createElement('p');
                notificationItem.textContent = notification;
                notificationsList.appendChild(notificationItem);
            });
        }

    
        async function loadBooks() {
            const usersData = await fetch('users.json').then(response => response.json());
            const loginValue = localStorage.getItem('login');
    
            if (!loginValue) {
                document.getElementById('book-container').innerHTML += '<p>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage.</p>';
                return;
            }
    
            const cleanedLoginValue = loginValue.replace(/\D/g, '');
            let userRole = null;
            let userFound = false;

            for (let school in usersData) {
                for (let grade in usersData[school].classes) {
                    const classData = usersData[school].classes[grade];
                    for (let student of classData) {
                        const storedPhoneNumber = student['–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'].replace(/\D/g, '');
                        if (storedPhoneNumber === cleanedLoginValue) {
                            userRole = student['–†–æ–ª—å'] || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                            userFound = true;
                            break;
                        }
                    }
                }
                if (userFound) break;
            }

            // –ï—Å–ª–∏ —Ä–æ–ª—å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –∑–∞–º–µ–Ω—è–µ–º "books" –Ω–∞ "requests"
            if (section === 'books' && userRole === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') {
                section = 'requests';
            }

            if (section === 'news') {
                content.innerHTML = `<h1>–ù–æ–≤–æ—Å—Ç–∏</h1><p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏.</p>`;
            } else if (section === 'books') {
                content.innerHTML = `<h1>–ö–Ω–∏–≥–∏</h1>
                    <div class="book-list" id="book-container">
                        <div class="book-header">
                            <div class="book-date">–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</div>
                            <div class="book-title">–ê–≤—Ç–æ—Ä –∏ –∑–∞–≥–ª–∞–≤–∏–µ –∫–Ω–∏–≥–∏</div>
                        </div>
                    </div>`;
                loadBooks(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥
            } else if (section === 'requests') {
                content.innerHTML = `<h1>–ó–∞—è–≤–∫–∏</h1>
                    <div id="requests-container"></div>`;
                loadRequests(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ (—Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ)
            }
        }

        // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å–º–µ–Ω—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        changeContent('books');

        async function loadRequests() {
        const response = await fetch('http://192.168.0.17:3000/get-requests');
        requests = await response.json(); // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∑–∞—è–≤–æ–∫
        const container = document.getElementById('requests-container');

        if (requests.length === 0) {
            container.innerHTML = "<p>–ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç.</p>";
            return;
        }

        container.innerHTML = ''; // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫

        const activeRequests = [];
        const archivedRequests = [];

        // –†–∞–∑–¥–µ–ª—è–µ–º –∑–∞—è–≤–∫–∏ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ –∏ –∞—Ä—Ö–∏–≤–Ω—ã–µ
        requests.forEach((req) => {
            if (req.archive) {
                archivedRequests.push(req);
            } else {
                activeRequests.push(req);
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å–ø–∏—Å–∫–∞ –∑–∞—è–≤–æ–∫
        function renderRequests(list) {
        list.forEach((req, index) => {
            const requestElement = document.createElement("div");
            requestElement.className = "request-item";
            requestElement.style.padding = '10px';
            requestElement.style.margin = '10px 0';
            requestElement.style.border = '1px solid #ddd';
            requestElement.style.borderRadius = '8px';
            requestElement.style.cursor = 'pointer';

            // –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ —Å —ç–º–æ–¥–∑–∏
            let statusEmoji = '‚è≥';  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å (–Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏)
            let statusText = '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏';
            
            if (req.status === '–ü—Ä–∏–Ω—è—Ç–∞') {
                statusEmoji = '‚úîÔ∏è';
                statusText = '–ü—Ä–∏–Ω—è—Ç–∞';
            } else if (req.status === '–û—Ç–∫–ª–æ–Ω–µ–Ω–∞') {
                statusEmoji = '‚ùå';
                statusText = '–û—Ç–∫–ª–æ–Ω–µ–Ω–∞';
            } else if (req.status === '–¢–∞–π–º-–∞—É—Ç') {
                statusEmoji = 'üîí';  // –≠–º–æ–¥–∑–∏ –¥–ª—è —Ç–∞–π–º-–∞—É—Ç–∞
                statusText = '–¢–∞–π–º-–∞—É—Ç';
            }

            // –î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
            const decisionDate = req.acceptedAt ? `<p><b>–î–∞—Ç–∞ ${req.status === '–ü—Ä–∏–Ω—è—Ç–∞' ? '–ø—Ä–∏–Ω—è—Ç–∏—è' : '–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è'}:</b> ${req.acceptedAt}</p>` : '';

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ISO-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–∞—Ç—É –≤ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
            const timeoutDate = req.timeoutAt ? 
                `<p><b>–î–∞—Ç–∞ —Ç–∞–π–º-–∞—É—Ç–∞:</b> ${new Date(req.timeoutAt).toLocaleString('ru-RU', { timeZone: 'Asia/Novosibirsk' })}</p>` 
                : '';


            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞—è–≤–∫–∏
            requestElement.innerHTML = `
                <h3>–ó–∞—è–≤–∫–∞ ‚Ññ${req.numzav} ${statusEmoji} (${statusText})</h3> <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–º–µ—Ä –∑–∞—è–≤–∫–∏ -->
                <p><b>–£—á–µ–±–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:</b> ${req.name}</p>
                <p><b>–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:</b> ${req.submittedAt}</p>
                ${decisionDate}
                ${timeoutDate}
            `;

            requestElement.onclick = () => showRequestDetails(requests.indexOf(req)); // –ü–µ—Ä–µ–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–µ—Ç–∞–ª–µ–π

            container.appendChild(requestElement);
        });
    }

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞—è–≤–∫–∏
    if (activeRequests.length > 0) {
        renderRequests(activeRequests);
    }

    // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª "–ê—Ä—Ö–∏–≤", –µ—Å–ª–∏ –µ—Å—Ç—å –∞—Ä—Ö–∏–≤–Ω—ã–µ –∑–∞—è–≤–∫–∏
    if (archivedRequests.length > 0) {
        const archiveTitle = document.createElement("h2");
        archiveTitle.innerText = "–ê—Ä—Ö–∏–≤";
        archiveTitle.style.marginTop = "20px";
        container.appendChild(archiveTitle);
        
        renderRequests(archivedRequests);
    }
        }




        function showRequestDetails(index) {
        const request = requests[index];
        const content = document.getElementById('content');

        content.innerHTML = `
            <div style="position: relative;">
                <button id="backBtn" style="
                    position: absolute;
                    top: 10px;
                    left: 10px;
                    background: transparent;
                    border: none;
                    font-size: 24px;
                    font-weight: bold;
                    color: #007bff;
                    cursor: pointer;
                ">&lt;</button>
            </div>
            
            <h1 style="text-align: center; margin-top: 30px;">–ó–∞—è–≤–∫–∞ ‚Ññ${index + 1}</h1>
            <p><b>–£—á–µ–±–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:</b> ${request.name}</p>
            <p><b>–ê–¥—Ä–µ—Å:</b> ${request.address}</p>
            <p><b>–†–∞–π–æ–Ω:</b> ${request.district}</p>
            <p><b>Email:</b> ${request.email}</p>
            <p><b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> ${request.phone}</p>
            <p><b>–°—Ç–∞—Ç—É—Å:</b> ${request.status || '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏'}</p>
            <p><b>–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:</b> ${request.submittedAt}</p>
        `;

        if (request.acceptedAt) {
            content.innerHTML += `<p><b>–î–∞—Ç–∞ ${request.status === '–ü—Ä–∏–Ω—è—Ç–∞' ? '–ø—Ä–∏–Ω—è—Ç–∏—è' : '–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è'}:</b> ${request.acceptedAt}</p>`;
        }

        // –ï—Å–ª–∏ –∑–∞—è–≤–∫–∞ –Ω–µ –∞—Ä—Ö–∏–≤–Ω–∞—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
        if (!request.archive) {
            content.innerHTML += `
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="acceptRequestBtn" style="
                        background-color: #007bff;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 16px;
                    ">–ü—Ä–∏–Ω—è—Ç—å</button>
                    
                    <button id="rejectRequestBtn" style="
                        background: white;
                        color: #007bff;
                        border: 2px solid #007bff;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 16px;
                    ">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                    
                    <button id="timeoutRequestBtn" style="
                        background: #f39c12;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 16px;
                    ">–¢–∞–π–º-–∞—É—Ç</button>
                </div>
            `;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∏–Ω—è—Ç—å"
            document.getElementById('acceptRequestBtn').onclick = async () => {
                request.status = '–ü—Ä–∏–Ω—è—Ç–∞';
                request.acceptedAt = new Date().toLocaleString("ru-RU", { timeZone: 'Asia/Novosibirsk' });
                request.archive = true;
                await updateRequestInDatabase(request);
                showRequestDetails(index);
            };

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–û—Ç–∫–ª–æ–Ω–∏—Ç—å"
            document.getElementById('rejectRequestBtn').onclick = async () => {
                rejectRequest(index);
            };

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–¢–∞–π–º-–∞—É—Ç"
            document.getElementById('timeoutRequestBtn').onclick = () => {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ç–∞–π–º-–∞—É—Ç–∞
                showTimeoutModal(index, request);
            };
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
        document.getElementById('backBtn').onclick = () => {
            content.innerHTML = `<h1>–ó–∞—è–≤–∫–∏</h1><div id="requests-container"></div>`;
            loadRequests();
        };
    }

    function showTimeoutModal(index, request) {
        const modal = document.createElement('div');
        modal.style.position = 'fixed';
        modal.style.top = '0';
        modal.style.left = '0';
        modal.style.width = '100%';
        modal.style.height = '100%';
        modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        modal.style.display = 'flex';
        modal.style.justifyContent = 'center';
        modal.style.alignItems = 'center';

        const modalContent = document.createElement('div');
        modalContent.style.backgroundColor = '#fff';
        modalContent.style.padding = '20px';
        modalContent.style.borderRadius = '8px';
        modalContent.style.textAlign = 'center';
        modalContent.innerHTML = `
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –¥–ª—è —Ç–∞–π–º-–∞—É—Ç–∞</h2>
            <div style="margin: 10px 0;">
                <button class="timeout-option" data-time="10">10 –º–∏–Ω—É—Ç</button>
                <button class="timeout-option" data-time="30">30 –º–∏–Ω—É—Ç</button>
                <button class="timeout-option" data-time="60">1 —á–∞—Å</button>
                <button class="timeout-option" data-time="1440">1 –¥–µ–Ω—å</button>
            </div>
            <button id="closeTimeoutModal" style="background-color: #e74c3c; color: white; border: none; padding: 10px; border-radius: 5px;">–ó–∞–∫—Ä—ã—Ç—å</button>
        `;

        modal.appendChild(modalContent);
        document.body.appendChild(modal);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ç–∞–π–º-–∞—É—Ç–∞
        const timeoutOptions = document.querySelectorAll('.timeout-option');
        timeoutOptions.forEach(option => {
            option.onclick = async () => {
                const time = parseInt(option.getAttribute('data-time'), 10);
                const timeoutDate = new Date();
                timeoutDate.setMinutes(timeoutDate.getMinutes() + time);

                console.log('Setting timeout at:', timeoutDate); // –ü—Ä–æ–≤–µ—Ä–∫–∞

                request.status = '–¢–∞–π–º-–∞—É—Ç';
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º toISOString –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO
                request.timeoutAt = timeoutDate.toISOString();  

                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞—è–≤–∫—É —Å —Ç–∞–π–º-–∞—É—Ç–æ–º
                try {
                    await updateRequestInDatabase(request);
                    console.log('Request updated successfully');
                    showRequestDetails(index);
                } catch (error) {
                    console.error('Error updating request:', error);
                }

                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                document.body.removeChild(modal);
            };
        });


        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        document.getElementById('closeTimeoutModal').onclick = () => {
            document.body.removeChild(modal);
        };
    }


    // –ü—Ä–∏–º–µ—Ä updateRequestInDatabase —Å –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    async function updateRequestInDatabase(request) {
        try {
            const response = await fetch('/update-request', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(request),
            });

            if (!response.ok) {
                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞—è–≤–∫—É');
            }

            console.log('Request updated:', request);
        } catch (error) {
            console.error('Error updating request:', error);
            throw error;
        }
    }




    async function acceptRequest(index) {
        const request = requests[index];
        request.status = '–ü—Ä–∏–Ω—è—Ç–∞';
        request.acceptedAt = new Date().toLocaleString("ru-RU", { timeZone: 'Asia/Novosibirsk' });
        request.archive = true;

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞—è–≤–∫—É –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –Ω–æ–º–µ—Ä—É
        await updateRequestInDatabase(request);

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫
        loadRequests();
    }

    async function rejectRequest(index) {
        const request = requests[index];
        request.status = '–û—Ç–∫–ª–æ–Ω–µ–Ω–∞';
        request.archive = true; // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –∞—Ä—Ö–∏–≤–Ω—É—é
        request.acceptedAt = new Date().toLocaleString("ru-RU", { timeZone: 'Asia/Novosibirsk' });

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞—è–≤–∫—É –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –Ω–æ–º–µ—Ä—É
        await updateRequestInDatabase(request);

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ (–∞ –Ω–µ –≤–µ—Å—å —Å–ø–∏—Å–æ–∫)
        showRequestDetails(index);
    }

    async function updateRequestInDatabase(updatedRequest) {
        const response = await fetch('http://192.168.0.17:3000/update-request', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedRequest) // –í–∫–ª—é—á–∞–µ–º numzav
        });

        if (!response.ok) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏.");
        }
    }
    </script>
    
    
</body>
</html>