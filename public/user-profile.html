<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Document</title>
    <style>

        

        /* Основные стили для страницы */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Секция с контентом */
        .content {
            margin-bottom: 60px; /* Высота панели навигации */
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f4f4f4;
        }

        /* Панель навигации */
        .navbar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #fff;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            padding: 10px 0;
            user-select: none;
        }

        /* Кнопки на панели */
        .navbar button {
            background: none;
            border: none;
            font-size: 16px;
            color: #333;
            cursor: pointer;
            padding: 10px;
            transition: color 0.3s;
        }

        .navbar button:hover {
            color: #007bff;
        }

        .navbar button.active {
            color: #007bff;
        }

        #profile-inf {
            width: 90%;
            min-height: 105px; /* Можно задать минимальную высоту */
            /* border: 1px solid; */
            margin: auto;
            background: #fff;
            box-shadow: 0 24px 48px #e6ebf566, 0 1px 4px #e3ebfc;
            border-radius: 12px;
            text-align: left;
            align-content: center;
            padding-left: 20px; /* Добавит отступы внутри */
            margin-bottom: 20px; /* Добавляем отступ снизу между профилем и уведомлениями */

        }

        .book-list {
            width: 93%;
            margin: auto;
            background: #fff;
            box-shadow: 0 24px 48px #e6ebf566, 0 1px 4px #e3ebfc;
            border-radius: 12px;
            padding: 10px;
        }

        /* Заголовок таблицы */
        .book-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            padding: 8px 11px;
            color: black;
            border-radius: 8px;
            margin-bottom: 8px;
            text-align: left;
            font-size: 14px;
            border-bottom: 2px solid #ddd; /* Добавил разделение между заголовком и списком */
        }

        /* Делаем текст в заголовке на одной линии */
        .book-header div {
            flex: 1;
            padding: 0 5px;
            white-space: nowrap; /* Запрещаем перенос строки в заголовке */
        }

        /* Название книги в списке */
        .book-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 14px;
        }

        /* Позволяем тексту переноситься в списке */
        .book-item .book-title {
            flex: 2;
            word-wrap: break-word; /* Позволяет переносу текста */
            padding-left: 46px;
        }

        /* Стили для колонок */
        .book-date {
            font-weight: bold;
            color: #007bff;
        }

        .book-title {
            color: #333;
        }

        .notifications-box {
            width: 84%;
            min-height: 105px; /* Задаем минимальную высоту */
            margin: auto;
            background: #fff;
            box-shadow: 0 24px 48px #e6ebf566, 0 1px 4px #e3ebfc;
            border-radius: 12px;
            text-align: left;
            padding-left: 20px; /* Отступы внутри */
            padding-top: 10px; /* Отступ сверху */
            padding-bottom: 10px; /* Отступ снизу */
            padding-right: 20px; /* Отступ справа, чтобы текст не упирался в край */
            word-wrap: break-word; /* Обеспечивает правильный перенос длинных слов */
        }

        .notifications-box h3 {
            margin: 0;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .notifications-box #notifications-list p {
            margin: 8px 0;
            font-size: 14px;
            color: #666;
            line-height: 1.5; /* Увеличим межстрочный интервал для лучшего восприятия */
        }

        #requests-container {
            user-select: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
            }

            .request-item {
            padding: 20px;
            background-color: #f4f4f4;
            border: 1px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            }

            .request-item:hover {
            background-color: #e0e0e0;
            }

            .btn {
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            }

            .btn-primary {
            background-color: #007bff;
            color: white;
            border: none;
            }

            .btn-outline-primary {
            background-color: white;
            color: #007bff;
            border: 1px solid #007bff;
            }

            #request-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.5);
            }

        * {
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* * {
            user-select: none;
        } */

    </style>
</head>
<body>

    <div class="content" id="content">
        <h1>Добро пожаловать!</h1>
        <p>Выберите одну из опций на панели навигации, чтобы изменить содержимое.</p>
    </div>    

    <div id="timeoutModal" style="display: none;">
    <h3>Выберите время тайм-аута</h3>
    <select id="timeoutSelect">
        <option value="600000">10 минут</option>
        <option value="1800000">30 минут</option>
        <option value="3600000">1 час</option>
        <option value="86400000">1 день</option>
    </select>
    <button onclick="applyTimeout()">Применить</button>
    <button onclick="closeTimeoutModal()">Закрыть</button>
</div>

    <div class="navbar">
        <button id="newsButton" onclick="changeContent('news')">Новости</button>
        <button id="booksButton" onclick="changeContent('books')">Книги</button>
        <button id="profileButton" onclick="changeContent('profile')">Профиль</button>
    </div>

    <script>
    const GOOGLE_SHEET_API = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhPRAF8zi6FD7yI54DCNvM52dp-gKI3gGxGZB1Ouztt6NwKA-WNpgkVJul7Zr9KCcYppPFBxTNdbSOXgNEYdVOlU5yNFyimK6sjyO0jvILct5juObuBOtZZ44Ln8I5yxzPbsWaFJmQr4i8X092RugeQueIS91q_AC5tuW-QdVYD9P1h9Kkm9Gsm1PtaaTMUthYYkvuLVRy5MNa6QRoxLSqFHpi6l9aCfZO1zQBabmeQ99PsKXQmHO-hC_7-jEE_7lhaEULubCMmhVb9E1kWmrxK0YSk0g&lib=MJehZtwQYGbxr_NY_BXuOB0TUDqEcDcnD"; // вставь сюда свою ссылку

    async function changeContent(section) {
        const content = document.getElementById('content');
        document.querySelectorAll('.navbar button').forEach(btn => btn.classList.remove('active'));
        const activeBtn = document.getElementById(`${section}Button`);
        if (activeBtn) activeBtn.classList.add('active');
    
        if (section === 'news') {
            content.innerHTML = `<h1>Новости</h1><p>Здесь будут отображаться последние новости.</p>`;
        } else if (section === 'books') {
            content.innerHTML = `<h1>Книги</h1>
                <div class="book-list" id="book-container">
                    <div class="book-header">
                        <div class="book-date">Дата выдачи</div>
                        <div class="book-title">Автор и заглавие книги</div>
                    </div>
                </div>`;
            await loadBooks(); // вызываем только после того, как контейнер добавлен
        } else if (section === 'profile') {
            content.innerHTML = `<h1>Профиль</h1>
                <div id="profile-inf"><div id="student-info"></div></div>
                <div id="notifications" class="notifications-box">
                    <h3>Последние уведомления</h3>
                    <div id="notifications-list"></div>
                </div>`;
            await loadStudentInfo(); // вызываем только после вставки HTML
            loadNotifications();
        }
    }
        
    changeContent('books'); // запуск по умолчанию

    async function fetchUserData() {
        const response = await fetch(GOOGLE_SHEET_API);
        const data = await response.json();
        return data.list1 || [];
    }

    function normalizePhone(phone) {
        return (phone || "").replace(/[^\d]/g, "");
    }

    async function loadStudentInfo() {
        const orgs = await fetchUserData();
        const login = localStorage.getItem('login');
        if (!login) {
            document.getElementById('student-info').innerText = "Телефон не найден.";
            return;
        }
        const normalizedLogin = normalizePhone(login);
        let found = false;
        let html = "";

        for (const org of orgs) {
            const studentsJson = JSON.parse(org.students_json || "{}");
            for (const className in studentsJson) {
                for (const student of studentsJson[className]) {
                    const studentPhone = normalizePhone(student["Номер телефона"]);
                    if (studentPhone === normalizedLogin) {
                        const label = student["Образование"] ? "Класс" : "Роль";
                        const value = student["Образование"] || student["Роль"] || "Не указано";
                        html = `
                            <p>${student["Фамилия"]} ${student["Имя"]} ${student["Отчество"]}</p>
                            <p>${label}: ${value}</p>
                        `;
                        found = true;
                        break;
                    }
                }
                if (found) break;
            }
            if (found) break;
        }

        document.getElementById("student-info").innerHTML = found ? html : "Пользователь не найден.";
    }

    async function loadBooks() {
        const response = await fetch(GOOGLE_SHEET_API);
        const data = await response.json();
        const orgs = data.list1 || [];
    
        const login = localStorage.getItem('login');
        if (!login) {
            document.getElementById('book-container').innerHTML += '<p>Номер телефона не найден.</p>';
            return;
        }
    
        const cleanedLogin = login.replace(/\D/g, '');
        const container = document.getElementById('book-container');
        let found = false;
    
        for (const org of orgs) {
            const studentsJson = JSON.parse(org.students_json || "{}");
            for (const className in studentsJson) {
                const students = studentsJson[className];
                for (const student of students) {
                    const phone = (student["Номер телефона"] || "").replace(/\D/g, '');
                    if (phone === cleanedLogin) {
                        if (Array.isArray(student.books) && student.books.length > 0) {
                            student.books.forEach(book => {
                                const bookItem = document.createElement('div');
                                bookItem.className = "book-item";
                                bookItem.innerHTML = `
                                    <div class="book-date">${book["Дата выдачи"] || "-"}</div>
                                    <div class="book-title">${book["Автор и заглавие книги"] || "Без названия"}</div>
                                `;
                                container.appendChild(bookItem);
                            });
                        } else {
                            container.innerHTML += `<p>Книги не найдены.</p>`;
                        }
                        found = true;
                        break;
                    }
                }
                if (found) break;
            }
            if (found) break;
        }
    
        if (!found) {
            container.innerHTML += `<p>Ученик не найден.</p>`;
        }
    }


    function loadNotifications() {
        const notifications = [
            "Уведомление 1: Пожалуйста, верните книгу до конца месяца.",
            "Уведомление 2: Новый учебный материал доступен.",
            "Уведомление 3: Ваши оценки обновлены."
        ];
        const list = document.getElementById("notifications-list");
        list.innerHTML = "";
        notifications.forEach(note => {
            const p = document.createElement("p");
            p.textContent = note;
            list.appendChild(p);
        });
    }
</script>

    
    
</body>
</html>
